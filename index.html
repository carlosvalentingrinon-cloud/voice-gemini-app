<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Gemini Voice PRO</title>
<style>
body { font-family: Arial; background:#111; color:white; padding:20px; }
textarea { width:100%; height:120px; font-size:16px; padding:10px; border-radius:8px; border:none; resize:none; }
button { margin-top:10px; padding:10px 20px; border-radius:8px; border:none; cursor:pointer; font-size:16px; margin-right:10px; }
#micBtn { background:#ff4d4d; color:white; }
#sendBtn { background:#4CAF50; color:white; }
#wave { display:flex; margin-top:15px; height:40px; align-items:flex-end; gap:2px; }
.bar { width:6px; background:#00ffcc; animation:wave 0.5s infinite ease-in-out; }
@keyframes wave { 0%,100% { height:10px; } 50% { height:40px; } }
#status { margin-top:10px; color:#aaa; }
#response { margin-top:20px; background:#222; padding:15px; border-radius:8px; white-space:pre-wrap; }
</style>
</head>
<body>

<h2> Gemini Voice PRO</h2>

<textarea id="prompt" placeholder="Habla o escribe aqu铆..."></textarea>
<br>
<button id="micBtn"> Activar voz</button>
<button id="sendBtn">Enviar a Gemini</button>

<div id="wave">
  <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
</div>

<div id="status"></div>
<div id="response"></div>

<script>
let recognition, isRecording = false;
const bars = document.querySelectorAll(".bar");

// Inicializar reconocimiento de voz
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if (!SpeechRecognition) alert("Tu navegador no soporta reconocimiento de voz. Usa Chrome o Edge.");

else {
  recognition = new SpeechRecognition();
  recognition.continuous = true;
  recognition.interimResults = true;
  recognition.lang = "es-ES";

  recognition.onstart = () => {
    isRecording = true;
    document.getElementById("wave").style.display = "flex";
    document.getElementById("status").innerText = "Escuchando...";
    animateWave();
  };

  recognition.onresult = (event) => {
    let transcript = "";
    for (let i = 0; i < event.results.length; i++) transcript += event.results[i][0].transcript;
    document.getElementById("prompt").value = transcript;
  };

  recognition.onerror = (event) => {
    document.getElementById("status").innerText = "Error: " + event.error;
    document.getElementById("wave").style.display = "none";
    isRecording = false;
  };

  recognition.onend = () => {
    document.getElementById("status").innerText = "Micr贸fono detenido";
    document.getElementById("wave").style.display = "none";
    isRecording = false;
  };
}

// Animaci贸n de ondas
function animateWave() {
  if (!isRecording) return;
  bars.forEach(bar => {
    const h = 10 + Math.random() * 30;
    bar.style.height = h + "px";
  });
  requestAnimationFrame(animateWave);
}

// Bot贸n micr贸fono
document.getElementById("micBtn").addEventListener("click", () => {
  if (!isRecording) recognition.start(); else recognition.stop();
});

// Bot贸n enviar a Gemini
document.getElementById("sendBtn").addEventListener("click", () => {
  const prompt = document.getElementById("prompt").value.trim();
  if (!prompt) { document.getElementById("status").innerText="Escribe o habla algo."; return; }

  document.getElementById("status").innerText = "Gemini pensando...";
  document.getElementById("response").innerText = "";

  const url = 'https://script.google.com/macros/s/AKfycbzy7fZfx71C06Lo759ScFmyXiUAARBqjfNV8hSJBhu3FvdIKdlrBt61OhimiTr_LB3ylQ/exec?prompt=' + encodeURIComponent(prompt);

  fetch(url)
    .then(r => r.text())
    .then(res => {
      document.getElementById("response").innerText = res;
      document.getElementById("status").innerText = "Respuesta recibida";
    })
    .catch(err => {
      document.getElementById("response").innerText = "Error: " + err.message;
      document.getElementById("status").innerText = "Error en llamada";
    });
});
</script>

</body>
</html>
