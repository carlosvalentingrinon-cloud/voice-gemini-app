<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Voice Gemini App</title>
  <style>
    body { font-family: Arial; background:#111; color:white; padding:20px; }
    textarea { width:100%; height:120px; font-size:16px; padding:10px; border-radius:8px; border:none; resize:none; }
    button { margin-top:10px; padding:10px 20px; border-radius:8px; border:none; cursor:pointer; font-size:16px; margin-right:10px; }
    #micBtn { background:#ff4d4d; color:white; }
    #sendBtn { background:#4CAF50; color:white; }
    #wave { display:none; margin-top:15px; }
    .bar { display:inline-block; width:4px; height:10px; margin:2px; background:#00ffcc; animation:wave 1s infinite ease-in-out; }
    @keyframes wave { 0%{height:10px;} 50%{height:40px;} 100%{height:10px;} }
    #status { margin-top:10px; color:#aaa; }
    #response { margin-top:20px; background:#222; padding:15px; border-radius:8px; white-space:pre-wrap; }
  </style>
</head>
<body>

<h2> Gemini Voice App</h2>

<textarea id="prompt" placeholder="Habla o escribe aqu铆..."></textarea>
<br>
<button id="micBtn"> Activar voz</button>
<button id="sendBtn">Enviar a Gemini</button>

<div id="wave">
  <div class="bar"></div><div class="bar"></div><div class="bar"></div>
  <div class="bar"></div><div class="bar"></div>
</div>

<div id="status"></div>
<div id="response"></div>

<script>
let recognition;
let isRecording = false;

// Inicializamos SpeechRecognition
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

if (!SpeechRecognition) {
  alert("Tu navegador no soporta reconocimiento de voz. Usa Chrome o Edge.");
} else {
  recognition = new SpeechRecognition();
  recognition.continuous = true;
  recognition.interimResults = true;
  recognition.lang = "es-ES";

  recognition.onstart = () => {
    isRecording = true;
    document.getElementById("wave").style.display = "block";
    document.getElementById("status").innerText = "Escuchando...";
  };

  recognition.onresult = (event) => {
    let transcript = '';
    for (let i = 0; i < event.results.length; i++) {
      transcript += event.results[i][0].transcript;
    }
    document.getElementById("prompt").value = transcript;
  };

  recognition.onerror = (event) => {
    document.getElementById("status").innerText = "Error: " + event.error;
    document.getElementById("wave").style.display = "none";
    isRecording = false;
  };

  recognition.onend = () => {
    document.getElementById("status").innerText = "Micr贸fono detenido";
    document.getElementById("wave").style.display = "none";
    isRecording = false;
  };
}

// Bot贸n de micr贸fono
document.getElementById("micBtn").addEventListener("click", () => {
  if (!isRecording) {
    recognition.start();
  } else {
    recognition.stop();
  }
});

// Bot贸n de enviar a Gemini
document.getElementById("sendBtn").addEventListener("click", () => {
  const prompt = document.getElementById("prompt").value.trim();
  const responseBox = document.getElementById("response");
  const status = document.getElementById("status");

  if (!prompt) {
    status.innerText = "Escribe o habla algo antes de enviar.";
    return;
  }

  responseBox.innerText = "";
  status.innerText = "Gemini pensando...";

  // TU URL DE APPS SCRIPT AQU
  const url = 'https://script.google.com/macros/s/AKfycbzy7fZfx71C06Lo759ScFmyXiUAARBqjfNV8hSJBhu3FvdIKdlrBt61OhimiTr_LB3ylQ/exec?prompt=' + encodeURIComponent(prompt);

  fetch(url)
    .then(res => res.text())
    .then(data => {
      responseBox.innerText = data;
      status.innerText = "Respuesta recibida";
    })
    .catch(err => {
      responseBox.innerText = "Error: " + err.message;
      status.innerText = "Error en llamada";
    });
});
</script>

</body>
</html>
